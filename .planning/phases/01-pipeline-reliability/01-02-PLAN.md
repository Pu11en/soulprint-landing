---
phase: 01-pipeline-reliability
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/chat/page.tsx
  - app/api/memory/status/route.ts
autonomous: true

must_haves:
  truths:
    - "User sees full pass status in chat UI — processing, complete, or failed with error details"
    - "User sees specific error message when full pass fails, not just a generic warning"
    - "Full pass status banner updates in real-time via polling (already polls every 5s)"
  artifacts:
    - path: "app/chat/page.tsx"
      provides: "Full pass status banner in chat UI"
      contains: "fullPassError"
    - path: "app/api/memory/status/route.ts"
      provides: "Full pass error details in API response"
      contains: "full_pass_error"
  key_links:
    - from: "app/chat/page.tsx"
      to: "app/api/memory/status/route.ts"
      via: "polling fetch every 5s"
      pattern: "fullPassStatus|fullPassError"
---

<objective>
Surface full pass status and error details in the chat UI so users know what's happening with their deep memory processing.

Purpose: Currently the chat page silently logs full pass failures to console.warn (line 252) — users have no idea their full pass failed or is still processing. PIPE-04 requires error details visible in the chat UI, not just hidden in console. Users need to see: (1) that deep memory is being built, (2) when it completes, (3) when it fails with actionable details.

Output: Chat page shows a dismissible status banner for full pass progress/completion/failure.
</objective>

<execution_context>
@/home/drewpullen/.claude/get-shit-done/workflows/execute-plan.md
@/home/drewpullen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@app/chat/page.tsx
@app/api/memory/status/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add full pass status banner to chat UI</name>
  <files>app/chat/page.tsx, app/api/memory/status/route.ts</files>
  <action>
**PIPE-04: Surface full pass status in chat UI**

**app/api/memory/status/route.ts** — Ensure error details are included (already mostly done):

1. Verify the API already returns `fullPassStatus` and `fullPassError` (it does, lines 68-69). No changes needed here unless `full_pass_started_at` is missing from the select query — check and add if needed for "processing since X" display.

2. Add `full_pass_started_at` to the select query (line 23) if it's not already there. It isn't currently selected. This is needed to show "Processing since 5 minutes ago..." in the UI.

**app/chat/page.tsx** — Add visible full pass status banner:

3. Add state for full pass display:
   ```typescript
   const [fullPassStatus, setFullPassStatus] = useState<string>('pending');
   const [fullPassError, setFullPassError] = useState<string | null>(null);
   const [fullPassDismissed, setFullPassDismissed] = useState(false);
   ```

4. In the existing `checkMemoryStatus` function (around line 243-256), update the state tracking:
   - Where it currently sets `fps` locally, also set the React state: `setFullPassStatus(fps)` and `setFullPassError(data.fullPassError || null)`.
   - Keep the existing logic that sets memoryStatus and stops polling.

5. Add a `FullPassBanner` component (inline, not separate file) that renders ABOVE the chat messages area, positioned fixed or sticky at top of chat. Use Tailwind classes consistent with the existing dark-mode-aware chat styling:

   ```tsx
   function FullPassBanner({ status, error, onDismiss }: { status: string; error: string | null; onDismiss: () => void }) {
     if (status === 'complete' || status === 'pending') return null;

     if (status === 'processing') {
       return (
         <div className="mx-4 mt-2 rounded-lg bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 p-3 text-sm text-blue-800 dark:text-blue-200 flex items-center gap-2">
           <div className="h-4 w-4 animate-spin rounded-full border-2 border-blue-500 border-t-transparent" />
           <span>Building deep memory from your conversations...</span>
           <button onClick={onDismiss} className="ml-auto text-blue-400 hover:text-blue-600 dark:hover:text-blue-300">&times;</button>
         </div>
       );
     }

     if (status === 'failed') {
       return (
         <div className="mx-4 mt-2 rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 p-3 text-sm text-amber-800 dark:text-amber-200">
           <div className="flex items-center gap-2">
             <span className="font-medium">Deep memory processing encountered an issue</span>
             <button onClick={onDismiss} className="ml-auto text-amber-400 hover:text-amber-600 dark:hover:text-amber-300">&times;</button>
           </div>
           {error && <p className="mt-1 text-xs opacity-75">{error}</p>}
           <p className="mt-1 text-xs opacity-60">Your AI still works with quick-pass data. Deep memory can be retried later.</p>
         </div>
       );
     }

     return null;
   }
   ```

6. Render the banner in the JSX just above the messages container (but below the header/conversation selector). Only render if NOT dismissed:
   ```tsx
   {!fullPassDismissed && <FullPassBanner status={fullPassStatus} error={fullPassError} onDismiss={() => setFullPassDismissed(true)} />}
   ```

7. Use amber/warning colors for failure (not red) since full pass failure is non-fatal — the user can still chat. Use blue for processing. The banner should be non-intrusive (small, top of chat area, dismissible).
  </action>
  <verify>
1. Read `app/api/memory/status/route.ts` — verify `full_pass_started_at` is in the select query
2. Read `app/chat/page.tsx` — verify:
   - `fullPassStatus`, `fullPassError`, `fullPassDismissed` state variables exist
   - `FullPassBanner` component renders with processing/failed states
   - Banner is rendered in JSX above messages area
   - Banner uses amber (warning) for failures, blue for processing
   - Banner is dismissible
3. Run `npm run build` to verify no TypeScript errors
  </verify>
  <done>
Chat UI shows dismissible full pass status banner. Users see "Building deep memory..." during processing and specific error details on failure. Banner uses non-intrusive amber/blue colors matching existing dark-mode-aware styling.
  </done>
</task>

</tasks>

<verification>
1. Read `app/chat/page.tsx` — FullPassBanner component exists with processing and failed states
2. Read `app/chat/page.tsx` — fullPassStatus state updated during polling
3. Read `app/api/memory/status/route.ts` — full_pass_started_at included in select
4. `npm run build` succeeds without TypeScript errors
</verification>

<success_criteria>
- Chat UI shows visible banner when full pass is processing or failed
- Error details from full_pass_error displayed to user
- Banner is dismissible (non-intrusive)
- Banner uses amber for failures (non-fatal), blue for processing
- Existing polling mechanism updates banner state automatically
</success_criteria>

<output>
After completion, create `.planning/phases/01-pipeline-reliability/01-02-SUMMARY.md`
</output>
