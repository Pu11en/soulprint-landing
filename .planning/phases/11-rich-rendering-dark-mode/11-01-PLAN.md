---
phase: 11-rich-rendering-dark-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/theme/theme-provider.tsx
  - app/layout.tsx
  - tailwind.config.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "Theme switches between light and dark when toggled"
    - "On first visit, theme matches OS/browser preference"
    - "Theme persists across page refreshes via localStorage"
    - "No FOUC (flash of unstyled content) on page load"
  artifacts:
    - path: "components/theme/theme-provider.tsx"
      provides: "next-themes wrapper for root layout"
      contains: "ThemeProvider"
    - path: "app/layout.tsx"
      provides: "Root layout with ThemeProvider wrapping children"
      contains: "ThemeProvider"
    - path: "tailwind.config.ts"
      provides: "Typography plugin for prose classes"
      contains: "typography"
  key_links:
    - from: "app/layout.tsx"
      to: "components/theme/theme-provider.tsx"
      via: "import and wrap children"
      pattern: "ThemeProvider"
    - from: "app/layout.tsx"
      to: "next-themes"
      via: "ThemeProvider with attribute='class'"
      pattern: "attribute.*class"
---

<objective>
Set up the dark mode infrastructure and install markdown rendering dependencies.

Purpose: Create the ThemeProvider foundation that all theme-aware components depend on, and install the packages needed for rich markdown rendering.
Output: ThemeProvider wired into root layout, typography plugin configured, all npm packages installed.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-rich-rendering-dark-mode/11-RESEARCH.md
@app/layout.tsx
@tailwind.config.ts
@components/ui/theme-toggle.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install packages and configure Tailwind typography plugin</name>
  <files>package.json, tailwind.config.ts</files>
  <action>
Install the required npm packages:
```bash
npm install react-markdown remark-gfm rehype-sanitize react-syntax-highlighter @tailwindcss/typography
npm install -D @types/react-syntax-highlighter
```

Update `tailwind.config.ts` to add the typography plugin:
- Add `require("@tailwindcss/typography")` to the plugins array (alongside existing `tailwindcss-animate`)
- This enables `prose` and `prose-invert` classes for markdown content styling

Do NOT change any other tailwind config (colors, fonts, darkMode setting -- those are already correct).
  </action>
  <verify>
Run `npm run build` -- should complete without errors. Verify `@tailwindcss/typography` appears in package.json dependencies and tailwind.config.ts plugins array.
  </verify>
  <done>
All 6 packages installed (react-markdown, remark-gfm, rehype-sanitize, react-syntax-highlighter, @tailwindcss/typography, @types/react-syntax-highlighter). Typography plugin added to Tailwind config. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ThemeProvider and wire into root layout</name>
  <files>components/theme/theme-provider.tsx, app/layout.tsx</files>
  <action>
1. Create `components/theme/theme-provider.tsx`:
   - 'use client' directive (required -- next-themes uses React context)
   - Import `ThemeProvider as NextThemesProvider` from 'next-themes'
   - Export a `ThemeProvider` wrapper component that passes through all props
   - Accept `children` and spread remaining props to NextThemesProvider

2. Update `app/layout.tsx`:
   - Import `ThemeProvider` from `@/components/theme/theme-provider`
   - Remove the hardcoded `className="dark"` from the `<html>` tag
   - Add `suppressHydrationWarning` to the `<html>` tag (required for next-themes to inject its blocking script without React warnings)
   - Wrap the `<body>` content (AchievementToastProvider + children) with `<ThemeProvider>` using these props:
     - `attribute="class"` (Tailwind uses class-based dark mode)
     - `defaultTheme="system"` (matches DARK-02: respect OS preference on first visit)
     - `enableSystem` (enables system preference detection)
     - `disableTransitionOnChange` (prevents FOUC flicker during theme switch)
   - Keep all existing font variables, metadata, viewport config unchanged

The existing `components/ui/theme-toggle.tsx` already uses `useTheme()` from next-themes and has proper mounted guard. It will work automatically once ThemeProvider is in the tree. No changes needed to theme-toggle.tsx.
  </action>
  <verify>
Run `npm run build` -- should complete without errors. Verify:
1. `app/layout.tsx` has `suppressHydrationWarning` on html tag
2. `app/layout.tsx` does NOT have `className="dark"` hardcoded
3. `ThemeProvider` wraps body content with `attribute="class"` and `defaultTheme="system"`
  </verify>
  <done>
ThemeProvider created and wired into root layout. Dark mode toggles via class on html element. System preference is respected on first visit (defaultTheme="system"). No FOUC due to next-themes blocking script + disableTransitionOnChange.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors
2. Theme infrastructure is in place (ThemeProvider in layout, typography plugin in Tailwind)
3. No hardcoded "dark" class on html element
4. All required packages are installed
</verification>

<success_criteria>
- ThemeProvider wraps the entire app via root layout
- System preference detection works (defaultTheme="system" + enableSystem)
- Tailwind typography plugin is available for prose classes
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/11-rich-rendering-dark-mode/11-01-SUMMARY.md`
</output>
